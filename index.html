<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SrfparkTLV - Tools</title>
  <meta name="description" content="Mobile-friendly pool calculators for SRF Park TLV: chlorine dosing and water fill by level (surface area or calibrated)." />
  <style>
    :root{ --bg:#0b1320; --card:#111a2b; --ink:#ecf1ff; --muted:#a8b3d1; --accent:#3ea6ff; --line:#1f2b44; --good:#5bd165; --warn:#ffcc66; --bad:#ff6b6b; --shadow:0 6px 20px rgba(0,0,0,.35); --radius:18px; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background: radial-gradient(1200px 600px at 15% -10%, #14213d 0%, transparent 60%), radial-gradient(1000px 500px at 95% 10%, #12243b 0%, transparent 60%), var(--bg); color:var(--ink)}
    header{position:sticky;top:0;z-index:5;backdrop-filter:blur(8px);background:linear-gradient(180deg,rgba(11,19,32,.85),rgba(11,19,32,.65));border-bottom:1px solid var(--line)}
    .wrap{max-width:980px;margin:0 auto;padding:18px 16px;position:relative}
    h1{margin:0;font-size:clamp(22px,3.4vw,34px)}
    .sub{color:var(--muted);font-size:13px;margin-top:6px}
    .lang-toggle{position:absolute;top:16px;right:16px} [dir="rtl"] .lang-toggle{left:16px;right:auto}
    main{padding:20px 16px 60px}
    .grid{display:grid;gap:18px;grid-template-columns:1fr}
    @media(min-width:880px){.grid{grid-template-columns:repeat(2,1fr)}}
    .card{background:linear-gradient(180deg,rgba(17,26,43,.85),rgba(17,26,43,.75));border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);display:flex;flex-direction:column;min-height:420px}
    .card h2{font-size:18px;margin:0;padding:16px;border-bottom:1px solid var(--line)}
    .card .body{padding:14px 16px 16px;display:grid;gap:12px}
    form{display:grid;gap:10px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .label{font-size:12px;color:var(--muted);margin-bottom:4px;display:flex;align-items:center;gap:8px}
    .req{font-size:10px;color:#061427;background:var(--accent);padding:2px 6px;border-radius:999px}
    .opt{font-size:10px;color:var(--ink);background:#26324d;padding:2px 6px;border-radius:999px}
    .help{font-size:11px;color:var(--muted);margin-top:4px}
    input,select{width:100%;padding:10px 12px;border:1px solid var(--line);background:#0f1726;color:var(--ink);border-radius:12px;font-size:14px}
    input[readonly]{background:#0b1320;opacity:.9}
    input:focus{outline:2px solid transparent;box-shadow:0 0 0 2px var(--accent)}
    .kpi{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .kpi .box{background:#0b1320;border:1px solid var(--line);border-radius:14px;padding:12px}
    .kpi .t{font-size:11px;color:var(--muted)}
    .kpi .v{font-size:20px;margin-top:6px;font-variant-numeric:tabular-nums}
    .footer{margin-top:auto;display:flex;justify-content:space-between;align-items:center;gap:8px;padding:12px 16px;border-top:1px solid var(--line)}
    .btn{border:1px solid var(--line);background:#0f1a2b;color:var(--ink);padding:10px 12px;border-radius:12px;font-weight:600;cursor:pointer}
    .btn.primary{background:linear-gradient(180deg,#3ea6ff,#2680d9);border-color:#1d5fb1;color:#061427}
    .note{font-size:11px;color:var(--muted)}
    .ok{color:var(--good)} .warn{color:var(--warn)} .err{color:var(--bad)}
    .table{width:100%;border-collapse:collapse;font-size:13px}
    .table th,.table td{border-bottom:1px dashed var(--line);padding:6px 4px;text-align:left}
    .table th{color:var(--muted);font-weight:600}
    .seg{margin-top:4px;padding-top:10px;border-top:1px dashed var(--line)}
    .rtl{direction:rtl}
    .method{display:flex;gap:8px;flex-wrap:wrap}
    .pill{padding:8px 10px;border:1px solid var(--line);border-radius:999px;cursor:pointer;background:#0f1a2b}
    .pill.active{background:linear-gradient(180deg,#3ea6ff,#2680d9);color:#061427;border-color:#1d5fb1}
    footer.site{text-align:center;color:var(--muted);font-size:12px;padding:24px 10px 40px}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1 id="title">SrfparkTLV - Tools</h1>
      <div class="sub" id="subtitle">Two calculators — Chlorine dosing & Water fill by level — mobile-first and simple</div>
      <button id="lang-toggle" class="btn lang-toggle" type="button">עברית</button>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">

      <!-- 1) Chlorine Dose Calculator -->
      <section class="card" id="chlorine-card">
        <h2 id="h2-chlorine">Chlorine Dose</h2>
        <div class="body">
          <form id="chlorine-form">
            <div>
              <label class="label" id="lbl-vol">Pool volume (m³) <span class="req" id="req">Required</span></label>
              <input type="number" id="vol_m3" min="0" step="0.01" value="29000" required />
              <div class="help" id="help-vol">Total water volume.</div>
            </div>
            <div class="row">
              <div>
                <label class="label" id="lbl-fc-now">Current FC (ppm) <span class="req">Required</span></label>
                <input type="number" id="fc_now" min="0" step="0.01" placeholder="e.g., 0.2" required />
              </div>
              <div>
                <label class="label" id="lbl-fc-target">Target FC (ppm) <span class="req">Required</span></label>
                <input type="number" id="fc_target" min="0" step="0.01" placeholder="e.g., 0.8" required />
              </div>
            </div>
            <div class="row">
              <div>
                <label class="label" id="lbl-cl-percent">Chlorine concentration (%) <span class="req">Required</span></label>
                <input type="number" id="cl_percent" min="1" max="20" step="0.1" value="12" required />
              </div>
              <div>
                <label class="label" id="lbl-density">Bleach density (kg/L) <span class="opt" id="opt-density">Default 1.17</span></label>
                <input type="number" id="bleach_density" min="1.00" max="1.30" step="0.01" value="1.17" />
              </div>
            </div>
            <details class="seg">
              <summary id="sum-how">How this works</summary>
              <div class="help" id="help-how">Δppm × volume(L) gives kg of available chlorine required / 1e6. Liters of liquid = required_mass / (concentration × density).</div>
            </details>
          </form>

          <div class="kpi">
            <div class="box">
              <div class="t" id="kpi-dppm">Δppm (target − current)</div>
              <div class="v" id="delta_ppm">–</div>
            </div>
            <div class="box">
              <div class="t" id="kpi-liters">Liquid chlorine needed</div>
              <div class="v" id="liters_needed">– L</div>
            </div>
          </div>

          <table class="table seg">
            <thead><tr><th id="th-item">Item</th><th id="th-value">Value</th></tr></thead>
            <tbody>
              <tr><td id="row-volL">Pool volume (L)</td><td id="vol_l">–</td></tr>
              <tr><td id="row-avail">Available chlorine per liter</td><td id="avail_per_L">– kg/L</td></tr>
              <tr><td id="row-req">Total required chlorine</td><td id="req_chlorine">– kg</td></tr>
            </tbody>
          </table>
        </div>
        <div class="footer">
          <button class="btn primary" id="btn-calc-1" onclick="calcChlorine()">Calculate</button>
          <div class="note" id="chlorine-note">Fill required fields, then Calculate.</div>
        </div>
      </section>

      <!-- 2) Water Fill by Level -->
      <section class="card" id="level-card">
        <h2 id="h2-level">Water Fill by Level</h2>
        <div class="body">
          <div class="method" id="method-pills">
            <span class="pill active" data-method="area" id="pill-area">Use surface area (m²)</span>
            <span class="pill" data-method="calib" id="pill-calib">Use full volume & level</span>
          </div>
          <form id="level-form">
            <!-- Method: AREA -->
            <div id="area-set">
              <div>
                <label class="label" id="lbl-surface">Surface area (m²) <span class="req">Required</span></label>
                <input type="number" id="surface_m2" min="0" step="0.01" placeholder="e.g., 12000" />
                <div class="help" id="help-surface">Horizontal water surface area of the pool/lagoon.</div>
              </div>
            </div>

            <!-- Method: CALIBRATION (hidden by default) -->
            <div id="calib-set" style="display:none;">
              <div class="row">
                <div>
                  <label class="label" id="lbl-full-vol">Full pool volume (m³) <span class="req">Required</span></label>
                  <input type="number" id="full_vol_m3" min="0" step="0.01" value="29000" />
                </div>
                <div>
                  <label class="label" id="lbl-full-lvl">Full water level height (m) <span class="req">Required</span></label>
                  <input type="number" id="full_level_m" min="0" step="0.001" value="2.88" />
                </div>
              </div>
              <div class="help" id="help-calib">Using a linear calibration: area = full_volume / full_level; ΔV = (target − current) × area.</div>
            </div>

            <div class="row">
              <div>
                <label class="label" id="lbl-now-lvl">Current water level (m) <span class="req">Required</span></label>
                <input type="number" id="level_now_m" min="-10" step="0.001" placeholder="e.g., 1.35" required />
              </div>
              <div>
                <label class="label" id="lbl-target-lvl">Target water level (m) <span class="req">Required</span></label>
                <input type="number" id="level_target_m" min="-10" step="0.001" placeholder="e.g., 1.45" required />
              </div>
            </div>

            <details class="seg">
              <summary id="sum-optional">Optional timing (if you want finish time)</summary>
              <div class="row">
                <div>
                  <label class="label" id="lbl-flow">Fill flow rate (m³/h) <span class="opt">Optional</span></label>
                  <input type="number" id="flow_m3h" min="0" step="0.01" placeholder="e.g., 99" />
                </div>
                <div>
                  <label class="label" id="lbl-start">Start time <span class="opt">Default: now</span></label>
                  <input type="datetime-local" id="start_time" />
                </div>
              </div>
              <div>
                <label class="label" id="lbl-round">Round finish to <span class="opt">Optional</span></label>
                <select id="round_to">
                  <option value="1">1 min</option>
                  <option value="5" selected>5 min</option>
                  <option value="10">10 min</option>
                  <option value="15">15 min</option>
                </select>
              </div>
            </details>
          </form>

          <div class="kpi">
            <div class="box">
              <div class="t" id="kpi-dh">Height to add</div>
              <div class="v" id="delta_h_out">– m</div>
            </div>
            <div class="box">
              <div class="t" id="kpi-dv">Volume to add</div>
              <div class="v" id="delta_v_out">– m³</div>
            </div>
          </div>

          <table class="table seg">
            <thead><tr><th id="th-item-2">Item</th><th id="th-value-2">Value</th></tr></thead>
            <tbody>
              <tr><td id="row-dvL">Volume to add (L)</td><td id="delta_v_l_out">– L</td></tr>
              <tr><td id="row-hrs">Computed hours (if flow given)</td><td id="hours_out">– h</td></tr>
              <tr><td id="row-finish">Finish time (if flow & start given)</td><td id="finish_time">–</td></tr>
            </tbody>
          </table>
        </div>
        <div class="footer">
          <button class="btn primary" id="btn-calc-2" onclick="calcLevel()">Calculate</button>
          <div class="note" id="level-note">Choose method, enter area OR full volume & level, then current and target. Optional: flow & start.</div>
        </div>
      </section>

    </div>

    <section class="seg" style="margin-top:24px;">
      <h3 style="margin:0 0 8px 0; font-size:16px;" id="usage-title">Usage notes</h3>
      <ul style="margin:8px 0 0 18px; line-height:1.6; color:var(--muted);" id="usage-list">
        <li id="usage-1">Only the input fields are editable. Results update when you press <strong>Calculate</strong>.</li>
        <li id="usage-2">All units are metric (m³, L, m, h). Time displays in your local timezone with a 24‑hour format.</li>
        <li id="usage-3">Numbers are rounded for display; underlying calculations keep full precision.</li>
      </ul>
    </section>
  </main>

  <footer class="site" id="footer-site">
    Made for SRF Park TLV • v1.3 • Single‑file app — ready for GitHub Pages.
  </footer>

  <script>
    function fmt(n, digits=2){ if(Number.isNaN(+n)) return '–'; return (+n).toLocaleString(undefined,{maximumFractionDigits:digits, minimumFractionDigits:0}); }
    function roundToMinutes(date, minutes){ const ms = minutes*60*1000; return new Date(Math.round(date.getTime()/ms)*ms); }

    // 1) Chlorine Dose
    function calcChlorine(){
      const V = parseFloat(document.getElementById('vol_m3').value);
      const fcNow = parseFloat(document.getElementById('fc_now').value);
      const fcTgt = parseFloat(document.getElementById('fc_target').value);
      const pct = parseFloat(document.getElementById('cl_percent').value);
      const rho = parseFloat(document.getElementById('bleach_density').value || '1.17'); // default density
      const note = document.getElementById('chlorine-note');

      if([V,fcNow,fcTgt,pct,rho].some(x=>Number.isNaN(x))){ note.textContent = currentLang==='he'? i18n.he.notes.needFields : i18n.en.notes.needFields; note.className='note err'; return; }
      if(fcTgt < fcNow){ note.textContent = currentLang==='he'? i18n.he.notes.targetLow : i18n.en.notes.targetLow; note.className='note warn'; } else { note.textContent = currentLang==='he'? i18n.he.notes.calc : i18n.en.notes.calc; note.className='note ok'; }

      const volL = V * 1000; // liters
      const dppm = Math.max(0, fcTgt - fcNow); // mg/L
      const req_kg = dppm * volL / 1e6; // kg of available chlorine
      const avail_per_L = (pct/100) * rho; // kg available per liter of liquid
      const liters = avail_per_L>0 ? req_kg / avail_per_L : NaN;

      document.getElementById('delta_ppm').textContent = fmt(dppm,3);
      document.getElementById('liters_needed').textContent = isFinite(liters)? `${fmt(liters,2)} L` : '– L';
      document.getElementById('vol_l').textContent = fmt(volL,0) + ' L';
      document.getElementById('avail_per_L').textContent = isFinite(avail_per_L)? `${fmt(avail_per_L,3)} kg/L` : '–';
      document.getElementById('req_chlorine').textContent = isFinite(req_kg)? `${fmt(req_kg,3)} kg` : '–';
    }

    // Method UI switching
    let method = 'area';
    const pills = document.getElementById('method-pills');
    function setMethod(m){
      method = m;
      document.getElementById('area-set').style.display = (m==='area')? 'block':'none';
      document.getElementById('calib-set').style.display = (m==='calib')? 'block':'none';
      // pill styles
      Array.from(pills.querySelectorAll('.pill')).forEach(p=> p.classList.toggle('active', p.dataset.method===m));
      // update helper text in note
      const note = document.getElementById('level-note');
      if(m==='area') note.textContent = currentLang==='he'? i18n.he.level.noteArea : i18n.en.level.noteArea;
      else note.textContent = currentLang==='he'? i18n.he.level.noteCalib : i18n.en.level.noteCalib;
    }
    if(pills){
      pills.addEventListener('click', (e)=>{
        const t = e.target.closest('.pill'); if(!t) return; setMethod(t.dataset.method);
      });
    }

    // 2) Water Fill by Level (area OR calibrated)
    function calcLevel(){
      const Hn = parseFloat(document.getElementById('level_now_m').value); // m
      const Ht = parseFloat(document.getElementById('level_target_m').value); // m
      const Q = parseFloat(document.getElementById('flow_m3h').value); // m3/h (optional)
      const startStr = document.getElementById('start_time').value; // optional
      const roundMin = parseInt(document.getElementById('round_to').value,10) || 5;
      const note = document.getElementById('level-note');

      if([Hn,Ht].some(x=>Number.isNaN(x))){ note.textContent = i18n[currentLang].level.needLevels; note.className='note err'; return; }

      let A = NaN; // effective area m2
      if(method==='area'){
        A = parseFloat(document.getElementById('surface_m2').value);
        if(Number.isNaN(A) || A<=0){ note.textContent = i18n[currentLang].level.needArea; note.className='note err'; return; }
      } else {
        const Vfull = parseFloat(document.getElementById('full_vol_m3').value);
        const Hfull = parseFloat(document.getElementById('full_level_m').value);
        if([Vfull,Hfull].some(x=>Number.isNaN(x)) || Hfull<=0){ note.textContent = i18n[currentLang].level.needCalib; note.className='note err'; return; }
        A = Vfull / Hfull;
      }

      const dH = Math.max(0, Ht - Hn); // m
      const dV = dH * A; // m3
      const dVL = dV * 1000; // L

      document.getElementById('delta_h_out').textContent = `${fmt(dH,3)} m`;
      document.getElementById('delta_v_out').textContent = `${fmt(dV,2)} m³`;
      document.getElementById('delta_v_l_out').textContent = `${fmt(dVL,0)} L`;

      if(Number.isFinite(Q) && Q>0 && dV>0){
        const hours = dV / Q; // h
        document.getElementById('hours_out').textContent = `${fmt(hours,3)} h`;
        const start = startStr ? new Date(startStr) : new Date();
        const finish = new Date(start.getTime() + hours*3600*1000);
        const finishRounded = roundToMinutes(finish, roundMin);
        document.getElementById('finish_time').textContent = finishRounded.toLocaleString([], {hour12:false});
      } else {
        document.getElementById('hours_out').textContent = '– h';
        document.getElementById('finish_time').textContent = '–';
      }

      if(dV>0){ note.textContent = i18n[currentLang].notes.calc; note.className='note ok'; }
      else { note.textContent = i18n[currentLang].level.noFill; note.className='note warn'; }
    }

    // Language toggle & i18n
    const i18n = {
      en: {
        title: 'SrfparkTLV - Tools',
        subtitle: 'Two calculators — Chlorine dosing & Water fill by level — mobile-first and simple',
        h2_chlorine: 'Chlorine Dose', h2_level: 'Water Fill by Level',
        required: 'Required', optional: 'Optional', defaultNow: 'Default: now', defaultDensity: 'Default 1.17',
        lbl_vol: 'Pool volume (m³)', lbl_fc_now:'Current FC (ppm)', lbl_fc_target:'Target FC (ppm)', lbl_cl_percent:'Chlorine concentration (%)', lbl_density:'Bleach density (kg/L)',
        help_vol: 'Total water volume.', how_title:'How this works', how_help:'Δppm × volume(L) gives kg of available chlorine required / 1e6. Liters of liquid = required_mass / (concentration × density).',
        h2_level_method_area:'Use surface area (m²)', h2_level_method_calib:'Use full volume & level',
        surface:'Surface area (m²)', help_surface:'Horizontal water surface area of the pool/lagoon.',
        full_vol:'Full pool volume (m³)', full_level:'Full water level height (m)', now_level:'Current water level (m)', target_level:'Target water level (m)',
        optionalTiming:'Optional timing (if you want finish time)', flow:'Fill flow rate (m³/h)', start:'Start time', round:'Round finish to',
        calib_help:'Using a linear calibration: area = full_volume / full_level; ΔV = (target − current) × area.',
        kpi_dppm:'Δppm (target − current)', kpi_liters:'Liquid chlorine needed',
        kpi_dh:'Height to add', kpi_dv:'Volume to add',
        th_item:'Item', th_value:'Value', th_item2:'Item', th_value2:'Value',
        row_volL:'Pool volume (L)', row_avail:'Available chlorine per liter', row_req:'Total required chlorine',
        row_dvL:'Volume to add (L)', row_hrs:'Computed hours (if flow given)', row_finish:'Finish time (if flow & start given)',
        usage_title:'Usage notes', usage_1:'Only the input fields are editable. Results update when you press <strong>Calculate</strong>.', usage_2:'All units are metric (m³, L, m, h). Time displays in your local timezone with a 24‑hour format.', usage_3:'Numbers are rounded for display; underlying calculations keep full precision.',
        footer:'Made for SRF Park TLV • v1.3 • Single‑file app — ready for GitHub Pages.',
        calcBtn:'Calculate', toggle:'עברית',
        notes:{calc:'Calculation complete.', needFields:'Please complete all required fields.', targetLow:'Target is below current. No addition needed.'},
        level:{needLevels:'Enter current and target levels.', needArea:'Enter a valid surface area in m².', needCalib:'Enter full volume and full level.', noFill:'Target is not above current — no fill volume needed.', noteArea:'Enter area + levels (optional: flow & start).', noteCalib:'Enter full volume & full level + levels.'}
      },
      he: {
        title: 'כלים עבור סרף פארק תל אביב',
        subtitle: 'שני מחשבונים — מינון כלור ומילוי לפי גובה — פשוט ומותאם לנייד',
        h2_chlorine: 'חישוב מינון כלור', h2_level: 'מילוי מים לפי גובה',
        required: 'חובה', optional: 'רשות', defaultNow: 'ברירת מחדל: עכשיו', defaultDensity: 'ברירת מחדל 1.17',
        lbl_vol: 'נפח בריכה (מ״ק)', lbl_fc_now:'כלור חופשי נוכחי (ppm)', lbl_fc_target:'כלור יעד (ppm)', lbl_cl_percent:'ריכוז כלור (%)', lbl_density:'צפיפות תמיסת כלור (ק"ג/ל׳)',
        help_vol: 'נפח מים כולל.', how_title:'איך זה עובד', how_help:'Δppm × נפח (ליטר) נותן ק״ג כלור זמין נדרש / 1e6. ליטרים של תמיסה = מסת כלור / (ריכוז × צפיפות).',
        h2_level_method_area:'שימוש בשטח פני מים (מ״ר)', h2_level_method_calib:'שימוש בנפח מלא וגובה מלא',
        surface:'שטח פני מים (מ״ר)', help_surface:'שטח אופקי של פני המים בלגונה/בריכה.',
        full_vol:'נפח מלא של הבריכה (מ״ק)', full_level:'גובה מים מלא (מ׳)', now_level:'גובה מים נוכחי (מ׳)', target_level:'גובה מים יעד (מ׳)',
        optionalTiming:'תזמון אופציונלי (אם רוצים זמן סיום)', flow:'ספיקה (מ״ק/ש׳)', start:'זמן התחלה', round:'עיגול זמן הסיום ל‑',
        calib_help:'כיול ליניארי: שטח = נפח_מלא / גובה_מלא; ΔV = (יעד − נוכחי) × שטח.',
        kpi_dppm:'Δppm (יעד − נוכחי)', kpi_liters:'ליטרים נדרשים של כלור',
        kpi_dh:'גובה להוספה', kpi_dv:'נפח להוספה',
        th_item:'פריט', th_value:'ערך', th_item2:'פריט', th_value2:'ערך',
        row_volL:'נפח בריכה (ל׳)', row_avail:'כלור זמין לליטר', row_req:'סה״כ כלור נדרש',
        row_dvL:'נפח להוספה (ל׳)', row_hrs:'שעות מחושבות (אם ניתנה ספיקה)', row_finish:'זמן סיום (אם ניתנו ספיקה והתחלה)',
        usage_title:'הנחיות שימוש', usage_1:'רק השדות ניתנים לעריכה. החישוב מתעדכן לאחר לחיצה על <strong>חשב</strong>.', usage_2:'היחידות במטרי (מ״ק, ל׳, מ׳, ש׳). הזמנים מוצגים באזור הזמן המקומי שלך בפורמט 24 שעות.', usage_3:'המספרים מעוגלים לתצוגה; החישוב נשמר בדיוק מלא.',
        footer:'יוצר עבור SRF Park TLV • v1.3 • קובץ יחיד — מוכן ל‑GitHub Pages.',
        calcBtn:'חשב', toggle:'English',
        notes:{calc:'החישוב הושלם.', needFields:'נא למלא את כל שדות החובה.', targetLow:'היעד נמוך מהנוכחי. אין צורך בהוספה.'},
        level:{needLevels:'הזן גובה נוכחי ויעד.', needArea:'הזן שטח פני מים תקין במ״ר.', needCalib:'הזן נפח מלא וגובה מלא.', noFill:'היעד אינו גבוה מהנוכחי — אין צורך במילוי.', noteArea:'הזן שטח + גבהים (אופציונלי: ספיקה וזמן התחלה).', noteCalib:'הזן נפח מלא וגובה מלא + גבהים.'}
      }
    };

    let currentLang = 'en';
    function applyLang(){
      const t = i18n[currentLang];
      document.documentElement.lang = (currentLang==='he'?'he':'en');
      document.documentElement.dir = (currentLang==='he'?'rtl':'ltr');
      document.body.classList.toggle('rtl', currentLang==='he');

      const set = (id, html)=>{ const el = document.getElementById(id); if(el) el.innerHTML = html; };
      set('title', t.title); set('subtitle', t.subtitle);
      set('h2-chlorine', t.h2_chlorine); set('h2-level', t.h2_level);

      set('lbl-vol', `${t.lbl_vol} <span class="req">${t.required}</span>`);
      set('lbl-fc-now', `${t.lbl_fc_now} <span class="req">${t.required}</span>`);
      set('lbl-fc-target', `${t.lbl_fc_target} <span class="req">${t.required}</span>`);
      set('lbl-cl-percent', `${t.lbl_cl_percent} <span class="req">${t.required}</span>`);
      set('lbl-density', `${t.lbl_density} <span class="opt">${t.defaultDensity}</span>`);
      set('help-vol', t.help_vol); set('sum-how', t.how_title); set('help-how', t.how_help);

      // Method pills
      set('pill-area', t.h2_level_method_area);
      set('pill-calib', t.h2_level_method_calib);
      set('lbl-surface', `${t.surface} <span class="req">${t.required}</span>`);
      set('help-surface', t.help_surface);

      set('lbl-full-vol', `${t.full_vol} <span class="req">${t.required}</span>`);
      set('lbl-full-lvl', `${t.full_level} <span class="req">${t.required}</span>`);
      set('help-calib', t.calib_help);

      set('lbl-now-lvl', `${t.now_level} <span class="req">${t.required}</span>`);
      set('lbl-target-lvl', `${t.target_level} <span class="req">${t.required}</span>`);
      set('sum-optional', t.optionalTiming);
      set('lbl-flow', `${t.flow} <span class="opt">${t.optional}</span>`);
      set('lbl-start', `${t.start} <span class="opt">${t.defaultNow}</span>`);
      set('lbl-round', `${t.round} <span class="opt">${t.optional}</span>`);

      set('kpi-dppm', t.kpi_dppm); set('kpi-liters', t.kpi_liters);
      set('kpi-dh', t.kpi_dh); set('kpi-dv', t.kpi_dv);

      set('th-item', t.th_item); set('th-value', t.th_value);
      set('th-item-2', t.th_item2); set('th-value-2', t.th_value2);

      set('row-volL', t.row_volL); set('row-avail', t.row_avail); set('row-req', t.row_req);
      set('row-dvL', t.row_dvL); set('row-hrs', t.row_hrs); set('row-finish', t.row_finish);

      set('usage-title', t.usage_title);
      set('usage-1', t.usage_1); set('usage-2', t.usage_2); set('usage-3', t.usage_3);
      const foot = document.getElementById('footer-site'); if(foot) foot.textContent = t.footer;

      const b1 = document.getElementById('btn-calc-1'); if(b1) b1.textContent = t.calcBtn;
      const b2 = document.getElementById('btn-calc-2'); if(b2) b2.textContent = t.calcBtn;

      const toggleBtn = document.getElementById('lang-toggle'); if(toggleBtn) toggleBtn.textContent = t.toggle;

      // Note text hint per method
      const note = document.getElementById('level-note');
      note.textContent = (method==='area') ? t.level.noteArea : t.level.noteCalib;
    }

    const toggle = document.getElementById('lang-toggle');
    if(toggle){ toggle.addEventListener('click', ()=>{ currentLang = (currentLang==='en'?'he':'en'); applyLang(); localStorage.setItem('srf_calc_lang', currentLang); }); }

    // Load preferred language
    let saved = localStorage.getItem('srf_calc_lang');
    if(saved === 'he' || saved === 'en') currentLang = saved;

    // Init
    applyLang();
    setMethod('area');

    // Prefill a couple of examples
    window.addEventListener('DOMContentLoaded', ()=>{
      document.getElementById('fc_now').value = '0.2';
      document.getElementById('fc_target').value = '0.8';
      document.getElementById('level_now_m').value = '';
      document.getElementById('level_target_m').value = '';
    });
  </script>
</body>
</html>
